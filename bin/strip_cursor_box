#!/usr/bin/env python3

"""Strip Cursor input boxes from stdin or files."""

import sys


TOP_LEFTS = {"\u250c", "\u00da"}
TOP_RIGHTS = {"\u2510", "\u00bf"}
BOTTOM_LEFTS = {"\u2514", "\u00c0"}
BOTTOM_RIGHTS = {"\u2518", "\u00d9"}


def decode_bytes(data):
    try:
        return data.decode("utf-8")
    except UnicodeDecodeError:
        return data.decode("latin-1")


def looks_like_top(line):
    trimmed = line.strip()
    return bool(trimmed) and trimmed[0] in TOP_LEFTS and trimmed[-1] in TOP_RIGHTS


def looks_like_bottom(line):
    trimmed = line.strip()
    return bool(trimmed) and trimmed[0] in BOTTOM_LEFTS and trimmed[-1] in BOTTOM_RIGHTS


def strip_box_lines(lines, out):
    in_box = False
    for line in lines:
        if not in_box:
            if looks_like_top(line):
                in_box = True
            continue
        if looks_like_bottom(line):
            return
        trimmed = line[5:]
        if trimmed:
            trimmed = trimmed[:-1] + " "
        trimmed = trimmed.rstrip()
        out.write(trimmed + "\n")


def process_bytes(data, out):
    text = decode_bytes(data)
    strip_box_lines(text.splitlines(), out)


def run(args):
    if args:
        for filename in args:
            with open(filename, "rb") as handle:
                process_bytes(handle.read(), sys.stdout)
    else:
        process_bytes(sys.stdin.buffer.read(), sys.stdout)


if __name__ == "__main__":
    run(args=sys.argv[1:])
